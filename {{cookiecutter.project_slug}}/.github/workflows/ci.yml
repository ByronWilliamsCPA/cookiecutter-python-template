# CI Pipeline - Calls Org-Level Reusable Workflow
# This is a lightweight caller workflow that invokes the organization's
# shared Python CI workflow for consistency across all projects.
{% if cookiecutter.include_github_actions == "yes" -%}
name: CI Pipeline

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]
  workflow_dispatch:

# Cancel in-progress runs for same PR/branch
concurrency:
  group: {% raw %}${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}{% endraw %}
  cancel-in-progress: true

jobs:
  ci:
    name: CI
    uses: {{ cookiecutter.github_org_or_user }}/.github/.github/workflows/python-ci.yml@main
    with:
      # Python versions to test
      python-versions: '["{{ cookiecutter.python_version }}"]'

      # Coverage settings
      coverage-threshold: {{ cookiecutter.code_coverage_target }}
      source-directory: 'src'
      test-directory: 'tests'

      # Quality checks
      {% if cookiecutter.use_mypy == "yes" -%}
      run-mypy: true
      mypy-strict: true
      {% else -%}
      run-mypy: false
      {% endif -%}

      {% if cookiecutter.use_ruff == "yes" -%}
      run-ruff: true
      {% else -%}
      run-ruff: false
      {% endif -%}

    {% if cookiecutter.include_codecov == "yes" -%}
    secrets:
      CODECOV_TOKEN: {% raw %}${{ secrets.CODECOV_TOKEN }}{% endraw %}
    {% endif -%}

permissions:
  contents: read
  checks: write
  pull-requests: write
{% endif -%}
